
{
 "servers": [

<% @servers.each_with_index do |server,index| -%>
<% unless index == 0 -%>
   ,
<% end -%>
  {
   "numQueryThreads": <%= server['numQueryThreads'] || 2 %>,
   "host": "<%= server['name'] %>",
   "username": "<%= server['username'] %>",
   "password": "<%= server['password'] %>",
   "port": <%= server['port'] %>,
   <% unless server['alias'] == Nil -%>
    "alias": "<%= server['alias'] %>,
   <% end -%>
   "queries": [
    <% server['queries'].each_with_index do |query,index| -%>
        <% unless index == 0 -%>
        ,
        <% end -%>
    {
     "outputWriters": [
      {
       "@class": "com.googlecode.jmxtrans.model.output.GraphiteWriter",
       "settings": {
        "typeNames": [   "name" ],
        "host": "<%= @graphite_host %>",
        "port": <%= @graphite_port %>,
        "rootPrefix": "<%= @root_prefix %>"
        <% unless key_suffix == Nil -%>
          ,
          "keySuffix": <%= @key_suffix %>
      <% end -%>
       }
      }
     ],
     "resultAlias": "<%= query['result_alias'] %>",
     "obj": "<%= query['obj'] %>",
     "attr": [<%= query['attr'].map {|t| "\""+t.to_s+"\""}.join(', ') %>]
    }
    <% end -%>
    ]
 }
<% end -%>
] 
}
